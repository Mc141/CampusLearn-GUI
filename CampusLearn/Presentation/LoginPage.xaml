<Page
    x:Class="CampusLearn.Presentation.LoginPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:utu="using:Uno.Toolkit.UI"
    utu:StatusBar.Foreground="Auto"
    Background="{ThemeResource BackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Main Content  -->
        <ScrollViewer
            Grid.Row="0"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto"
            ZoomMode="Disabled">

            <StackPanel
                x:Name="LoginContainer"
                Margin="20"
                MaxWidth="400"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="24">

                <!--  CampusLearn Logo  -->
                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                    <TextBlock Text="Campus" FontSize="32" FontWeight="Bold"
                               Foreground="{ThemeResource OnSurfaceBrush}"/>
                    <TextBlock Text="Learn" FontSize="32" FontWeight="Bold"
                               Foreground="#FFC107"/>
                    <TextBlock Text="™" FontSize="18" FontWeight="Bold"
                               Foreground="#FFC107" VerticalAlignment="Top" Margin="4,0,0,0"/>
                </StackPanel>

                <!--  Header Text  -->
                <TextBlock
                    x:Name="HeaderText"
                    HorizontalAlignment="Center"
                    FontSize="20"
                    FontWeight="SemiBold"
                    Foreground="{ThemeResource OnSurfaceBrush}"
                    TextAlignment="Center"
                    TextWrapping="Wrap"/>

                <TextBlock
                    HorizontalAlignment="Center"
                    FontSize="14"
                    Foreground="#49454F"
                    TextAlignment="Center"
                    Text="Use your Belgium Campus email"
                    TextWrapping="Wrap" />

                <!-- Full Name (Registration only) -->
                <StackPanel x:Name="FullNameSection" Spacing="8">
                    <TextBlock Text="Full Name" FontSize="14" Foreground="#49454F"/>
                    <TextBox 
                        Text="{Binding FullName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        PlaceholderText="Enter your full name"
                        FontSize="15"
                        BorderBrush="{ThemeResource OutlineBrush}"
                        CornerRadius="8"
                        Padding="12"
                        Height="48"/>
                </StackPanel>

                <!--  Email Input  -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Email" FontSize="14" Foreground="#49454F"/>
                    <TextBox 
                        Text="{Binding Email, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        PlaceholderText="577963@student.belgiumcampus.ac.za"
                        FontSize="15"
                        BorderBrush="{ThemeResource OutlineBrush}"
                        CornerRadius="8"
                        Padding="12"
                        Height="48"/>
                </StackPanel>

                <!--  Password Input  -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Password" FontSize="14" Foreground="#49454F"/>
                    <PasswordBox 
                        x:Name="PasswordInput"
                        Password="{Binding Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        PasswordChanged="OnPasswordChanged"
                        PlaceholderText="Enter your password"
                        FontSize="15"
                        BorderBrush="{ThemeResource OutlineBrush}"
                        CornerRadius="8"
                        Padding="12"
                        Height="48"/>
                </StackPanel>

                <!-- Forgot Password (Login only) -->
                <HyperlinkButton 
                    x:Name="ForgotPasswordButton"
                    Content="Forgot Password?"
                    Command="{Binding ForgotPasswordCommand}"
                    HorizontalAlignment="Right"
                    Foreground="#6750A4"
                    FontSize="13"/>

                <!--  Status Message  -->
                <TextBlock
                    Text="{Binding StatusMessage}"
                    Foreground="#D32F2F"
                    FontSize="13"
                    TextWrapping="Wrap"
                    HorizontalAlignment="Center"
                    TextAlignment="Center"/>

                <!--  Login Button  -->
                <Button
                    x:Name="LoginButton"
                    Height="48"
                    HorizontalAlignment="Stretch"
                    Background="#6750A4"
                    Foreground="White"
                    CornerRadius="8"
                    FontSize="15"
                    FontWeight="SemiBold"
                    Command="{Binding LoginCommand}"
                    Click="OnLoginButtonClick">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                        <ProgressRing 
                            Width="20" 
                            Height="20" 
                            IsActive="{Binding IsLoading}"
                            Foreground="White"
                            Visibility="{Binding IsLoading}"/>
                        <TextBlock x:Name="LoginButtonText" Text="Sign In" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Register Button -->
                <Button
                    x:Name="RegisterButton"
                    Height="48"
                    HorizontalAlignment="Stretch"
                    Background="#6750A4"
                    Foreground="White"
                    CornerRadius="8"
                    FontSize="15"
                    FontWeight="SemiBold"
                    Command="{Binding RegisterCommand}"
                    Click="OnRegisterButtonClick"
                    Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                        <ProgressRing 
                            Width="20" 
                            Height="20" 
                            IsActive="{Binding IsLoading}"
                            Foreground="White"
                            Visibility="{Binding IsLoading}"/>
                        <TextBlock Text="Create Account" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!--  Toggle Mode  -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4">
                    <TextBlock 
                        x:Name="ToggleText"
                        Text="Don't have an account?"
                        FontSize="14" 
                        Foreground="#49454F"
                        VerticalAlignment="Center"/>
                    <HyperlinkButton 
                        x:Name="ToggleButton"
                        Content="Sign Up"
                        Command="{Binding ToggleModeCommand}"
                        Foreground="#6750A4"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Padding="4,0"/>
                </StackPanel>

                <Rectangle Height="1" Fill="{ThemeResource OutlineBrush}" Margin="0,16"/>

                <TextBlock
                    HorizontalAlignment="Center"
                    FontSize="12"
                    Foreground="#49454F"
                    TextAlignment="Center"
                    TextWrapping="Wrap"
                    Text="By signing in, you agree to our Terms of Service and Privacy Policy" />

            </StackPanel>
        </ScrollViewer>

        <!--  Footer  -->
        <StackPanel
            Grid.Row="1"
            Margin="20"
            HorizontalAlignment="Center"
            Spacing="8">
            <TextBlock
                HorizontalAlignment="Center"
                FontSize="12"
                Opacity="0.6"
                Foreground="{ThemeResource OnSurfaceBrush}"
                Text="Powered By Belgium Campus" />
        </StackPanel>

        <!--  Visual State Manager  -->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="AuthModeStates">
                <!--  Login Mode  -->
                <VisualState x:Name="LoginMode">
                    <VisualState.Setters>
                        <Setter Target="HeaderText.Text" Value="Sign in to your account" />
                        <Setter Target="FullNameSection.Visibility" Value="Collapsed" />
                        <Setter Target="ForgotPasswordButton.Visibility" Value="Visible" />
                        <Setter Target="LoginButton.Visibility" Value="Visible" />
                        <Setter Target="RegisterButton.Visibility" Value="Collapsed" />
                        <Setter Target="ToggleText.Text" Value="Don't have an account?" />
                        <Setter Target="ToggleButton.Content" Value="Sign Up" />
                    </VisualState.Setters>
                </VisualState>

                <!--  Register Mode  -->
                <VisualState x:Name="RegisterMode">
                    <VisualState.Setters>
                        <Setter Target="HeaderText.Text" Value="Create your account" />
                        <Setter Target="FullNameSection.Visibility" Value="Visible" />
                        <Setter Target="ForgotPasswordButton.Visibility" Value="Collapsed" />
                        <Setter Target="LoginButton.Visibility" Value="Collapsed" />
                        <Setter Target="RegisterButton.Visibility" Value="Visible" />
                        <Setter Target="ToggleText.Text" Value="Already have an account?" />
                        <Setter Target="ToggleButton.Content" Value="Sign In" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</Page>
